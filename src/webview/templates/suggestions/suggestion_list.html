{% extends "base.html" %}
{% load viewutils %}

{% block content %}

<div class="column gap">
  {% if package_filter is not None %}

  <div id="search-panel">
    <h1 class="page-title row gap-small centered"><i class="icon-search"></i>Suggestions search</h1>
    <div class="column gap-small">
      <div class="rounded-box {% if result_count == 0 %}hl-red{% else %}hl-green{% endif %} column gap-small">
        <div class="row gap spread wrap">
            <div class="row gap-small centered bold">
              {% if status_filter is not None %}
                {% status_icon status_filter %}
                {% if status_filter == "pending" %}Untriaged
                {% elif status_filter == "rejected" %}Dismissed
                {% elif status_filter == "accepted" %}Accepted
                {% elif status_filter == "published" %}Published
                {% endif %}
              {% else %}
                All statuses
              {% endif %}
            </div>
          <div class="row gap">
            Filter by:
            <ul class="row gap">
              <li class="row gap-small centered"><a href="{% url 'webview:suggestion:suggestions_by_package' package_filter %}">All statuses</a></li>
              <li class="row gap-small centered"><i class="icon-bin"></i><a href="{% url 'webview:suggestion:suggestions_by_package' package_filter %}?status=rejected">Dismissed</a></li>
              <li class="row gap-small centered"><i class="icon-inbox"></i><a href="{% url 'webview:suggestion:suggestions_by_package' package_filter %}?status=pending">Untriaged</a></li>
              <li class="row gap-small centered"><i class="icon-draft"></i><a href="{% url 'webview:suggestion:suggestions_by_package' package_filter %}?status=accepted">Accepted</a></li>
              <li class="row gap-small centered"><i class="icon-github"></i><a href="{% url 'webview:suggestion:suggestions_by_package' package_filter %}?status=published">Published</a></li>
            </ul>
          </div>
        </div>
        <div class="row gap-small baseline"><i class="icon-folder"></i>With package: <span class="bold">{{package_filter}}</span></div>
        <div>
          {% if result_count == 0 %}
          <p>No matching suggestions found</p>
          {% else %}
          <p>Found {{ result_count }} matching suggestions</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% elif status_filter == "pending" %}

  <div>
    <h1 class="page-title row gap-small centered">{% status_icon "pending" %}Automatically generated suggestions</h1>
    <div class="prose">
      <p><button class="btn btn-gray inline-row gap-small centered" disabled>{% status_icon "rejected" %}Dismiss</button> to remove a suggestion from the queue.</p>
    </div>
  </div>

  {% elif status_filter == "rejected" %}

  <div>
    <h1 class="page-title row gap-small centered">{% status_icon "rejected" %}Dismissed suggestions</h1>
    <div class="prose">
      <p>These automatic suggestions were dismissed after initial triaging.</p>
      <p><button class="btn btn-green inline-row gap-small centered" disabled>{% status_icon "accepted" %}Accept suggestion</button> to select a suggestion for a revision.</p>
    </div>
  </div>

  {% elif status_filter == "accepted" %}

  <div>
    <h1 class="page-title row gap-small centered">{% status_icon "accepted" %}Accepted suggestions</h1>
    <div class="prose">
      <p><button class="btn btn-green inline-row gap-small centered" disabled>{% status_icon "published" %}Publish issue</button> to create a Nixpkgs security record and open a GitHub issue for tracking resolution. This action will notify maintainers and package subscribers, and cannot be revoked.</p>
      <p><button class="btn btn-gray inline-row gap-small centered" disabled>{% status_icon "rejected" %}Dismiss</button> to remove a suggestion from the queue.</p>
    </div>
  </div>

  {% elif status_filter == "published" %}

  <h1 class="page-title row gap-small centered">{% status_icon "published" %}Published suggestions</h1>

  {% endif %}

  <div class="column gap">
    {% for s in suggestions %}
      {% suggestion s %}
    {% endfor %}
  </div>

<div>
{% endblock content %}
